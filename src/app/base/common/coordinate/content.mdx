
# 空间

## 空间类型

### 对象空间 Object Space (Local Space)

物体空间，也叫局部空间。指的是对象自身的坐标系，在这个空间中，物体的顶点位置、法线等信息都是相对于物体的原点的  
appdata 就是这个空间的参数，比如顶点位置、法线、切线、颜色等

```shader
// 获取世界空间的法线，可以用作光照计算
UnityObjectToWorldNormal(v.normal);

// 获取世界空间坐标，拿到坐标后可以进一步获取世界空间的其他内容
worldPos = mul(unity_ObjectToWorld, v.vertex).xyz;

// 例如根据世界空间坐标获取光照
normalize(UnityWorldSpaceLightDir(worldPos)); 
```

### 世界空间 World Space

世界空间，指的是物体在世界坐标系中的位置，这个坐标系是固定的，不会随着物体的移动而改变。  
在物体空间中，物体的顶点位置、法线等信息都是相对于物体的原点的，但是在世界空间中，物体的顶点位置、法线等信息都是相对于世界坐标系的原点的  
大部分特效都是基于这个坐标系计算的

### 观察空间 View Space

观察空间，也叫相机空间，指的是物体相对于相机的位置，这个坐标系是固定的，不会随着相机的移动而改变。  
在观察空间中，物体的顶点位置、法线等信息都是相对于相机坐标系的原点的

### 裁剪空间 Clip Space

裁剪空间，也叫剪裁空间，指的是物体在经过裁剪后的位置，这个坐标系是固定的，不会随着物体的移动而改变。  
在裁剪空间中，物体的顶点位置、法线等信息都是相对于裁剪坐标系的原点的

### 屏幕空间 Screen Space

屏幕空间，也叫屏幕坐标系，指的是物体在屏幕上的位置，这个坐标系是固定的，不会随着物体的移动而改变。  
在屏幕空间中，物体的顶点位置、法线等信息都是相对于屏幕坐标系的原点的

## 空间转换

### Object Space (Local Space) 到 World Space

 应用模型矩阵 M。
```
WorldPosition=M×ObjectPosition
```

### World Space 到 View Space (Camera Space)


应用视图矩阵 V。
```
ViewPosition=V×WorldPosition
```

### View Space 到 Clip Space

应用投影矩阵 P。
```
ClipPosition=P×ViewPosition
```

### Clip Space 到 Normalized Device Coordinates (NDC)

透视除法。  

![link](data:image/png;base64,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)

### NDC 到 Screen Space

```
ScreenPosition=ViewportTransform×NDC
```

### Rasterization and Fragment Shading
- 将转换后的顶点坐标进行栅格化（Rasterization），生成像素覆盖的信息。
- 对每个生成的片段（Fragment）应用片段着色器，最终确定屏幕上每个像素的颜色。

### 最终输出到 Framebuffer
转换内容: 着色后的片段颜色被写入帧缓冲区（Framebuffer），这是最终显示在屏幕上的图像数据。

### 总结

1. Object Space (Local Space)
2. World Space
3. View Space (Camera Space)
4. Clip Space
5. Normalized Device Coordinates (NDC)
6. Screen Space